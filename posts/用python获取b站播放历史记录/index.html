<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta name=author content="ç¥å¥‡çš„æˆ˜å£«"><link rel=prev href=https://wangshub.github.io/posts/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%E7%AD%96%E7%95%A5%E6%A2%AF%E5%BA%A6%E7%AE%97%E6%B3%95/><link rel=next href=https://wangshub.github.io/posts/vanilla-policy-gradient/><link rel=canonical href=https://wangshub.github.io/posts/%E7%94%A8python%E8%8E%B7%E5%8F%96b%E7%AB%99%E6%92%AD%E6%94%BE%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BD%95/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><title>ç”¨Pythonè·å–Bç«™æ’­æ”¾å†å²è®°å½• | ğŸ‰ ç¥å¥‡çš„æˆ˜å£«</title><meta name=title content="ç”¨Pythonè·å–Bç«™æ’­æ”¾å†å²è®°å½• | ğŸ‰ ç¥å¥‡çš„æˆ˜å£«"><link rel=stylesheet href=/css/main.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/wangshub.github.io"},"articleSection":"posts","name":"ç”¨Pythonè·å–Bç«™æ’­æ”¾å†å²è®°å½•","headline":"ç”¨Pythonè·å–Bç«™æ’­æ”¾å†å²è®°å½•","description":"ç”¨ Python è·å– B ç«™æ’­æ”¾å†å²è®°å½• æœ€è¿‘ B ç«™å‡ºäº†ä¸€ä¸ªå¹´åº¦æŠ¥å‘Šï¼Œç»Ÿè®¡ç”¨æˆ·ä¸€å¹´å½“ä¸­åœ¨ B ç«™ä¸Šè§‚çœ‹è§†é¢‘çš„æ€»æ—¶é•¿å’Œæ€»ä¸ªæ•°ã€‚è¿‡å»ä¸€å¹´æˆ‘å±…ç„¶åœ¨ B ç«™ä¸Šçœ‹äº† 2600\u002b ä¸ªè§†é¢‘ï¼Œæ€»è®¡","inLanguage":"zh-cn","author":"ç¥å¥‡çš„æˆ˜å£«","creator":"ç¥å¥‡çš„æˆ˜å£«","publisher":"ç¥å¥‡çš„æˆ˜å£«","accountablePerson":"ç¥å¥‡çš„æˆ˜å£«","copyrightHolder":"ç¥å¥‡çš„æˆ˜å£«","copyrightYear":"2019","datePublished":"2019-01-22 18:40:22 \u002b0000 UTC","dateModified":"2019-01-22 18:40:22 \u002b0000 UTC","url":"https:\/\/wangshub.github.io\/posts\/%E7%94%A8python%E8%8E%B7%E5%8F%96b%E7%AB%99%E6%92%AD%E6%94%BE%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BD%95\/","wordCount":"589","keywords":["ğŸ‰ ç¥å¥‡çš„æˆ˜å£«"]}</script></head><body><div class=wrapper><nav class=navbar><progress class=content_progress max=0 value=0></progress><div class=container><div class="navbar-header header-back2home-logo"><span class=logo_mark>>$</span>
<a href=https://wangshub.github.io><span class=logo_text>cd /home/</span>
<span class=logo_cursor></span></a></div><div class=navbar-right><span class=menu><a class=menu-item href=/posts/>Blog</a>
<a class=menu-item href=/categories/>Categories</a>
<a class=menu-item href=/tags/>Tags</a>
<a class=menu-item href=/about/>About</a>
<span class=divide></span><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-dark-mode"></i></a></span></div></div></nav><nav class=navbar-mobile id=nav-mobile style=display:none><progress class=content_progress max=0 value=0></progress><div class=container><div class=navbar><div class="navbar-header header-logo"><a href=https://wangshub.github.io>ğŸ‰ ç¥å¥‡çš„æˆ˜å£«</a></div><div class=navbar-right><div><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-dark-mode"></i></a></div><div class=menu-toggle><span></span><span></span><span></span></div></div></div><div class=menu id=mobile-menu><nav class=mb-md><a class=menu-item href=/posts/><h3>Blog</h3><div class=menu-active></div></a><a class=menu-item href=/categories/><h3>Categories</h3><div class=menu-active></div></a><a class=menu-item href=/tags/><h3>Tags</h3><div class=menu-active></div></a><a class=menu-item href=/about/><h3>About</h3><div class=menu-active></div></a></nav></div></div></nav><main class=main><div class=container><article class=post-warp itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop="name headline">ç”¨Pythonè·å–Bç«™æ’­æ”¾å†å²è®°å½•</h1><div class=post-meta>Written by <a itemprop=name href=https://wangshub.github.io rel=author>ç¥å¥‡çš„æˆ˜å£«</a> with â™¥
<span class=post-time>on <time datetime=2019-01-22 itemprop=datePublished>January 22, 2019</time></span>
in
<span class=post-word-count>589 words</span></div></header><div class=post-content><h1 id=ç”¨-python-è·å–-b-ç«™æ’­æ”¾å†å²è®°å½•>ç”¨ Python è·å– B ç«™æ’­æ”¾å†å²è®°å½•</h1><p>æœ€è¿‘ B ç«™å‡ºäº†ä¸€ä¸ªå¹´åº¦æŠ¥å‘Šï¼Œç»Ÿè®¡ç”¨æˆ·ä¸€å¹´å½“ä¸­åœ¨ B ç«™ä¸Šè§‚çœ‹è§†é¢‘çš„æ€»æ—¶é•¿å’Œæ€»ä¸ªæ•°ã€‚è¿‡å»ä¸€å¹´æˆ‘å±…ç„¶åœ¨ B ç«™ä¸Šçœ‹äº† <code>2600+</code> ä¸ªè§†é¢‘ï¼Œæ€»è®¡ <code>251</code> ä¸ªå°æ—¶ï¼Œå±…ç„¶èŠ±äº†è¿™ä¹ˆå¤šæ—¶é—´ï¼Œå“å¾—æˆ‘å·®ç‚¹æŠŠ Bilibili App å¸è½½äº†&mldr;</p><p><img src=https://ws1.sinaimg.cn/large/c3a916a7gy1fzfksqinlgj208i07475z.jpg alt></p><p>ç„¶è€Œæˆ‘åˆå¾ˆå¥½å¥‡ï¼Œåˆ°åº•æˆ‘åœ¨ B ç«™ä¸Šéƒ½çœ‹äº†äº›ä»€ä¹ˆç±»å‹ <del>å°å§å§</del> çš„è§†é¢‘ï¼Œç”¨å‡ è¡Œ Python ä»£ç å®ç°äº†ä¸€ä¸‹ã€‚</p><h2 id=è·å–è¯·æ±‚-api-æ¥å£ä¸-cookie>è·å–è¯·æ±‚ Api æ¥å£ä¸ Cookie</h2><p>å®ç°èµ·æ¥éå¸¸å®¹æ˜“ï¼Œè·å– cookie æ¨¡æ‹Ÿè¯·æ±‚å³å¯</p><ol><li><p>ä½¿ç”¨ chrome æµè§ˆå™¨</p></li><li><p>ç™»é™† <a href=https://www.bilibili.com>B ç«™</a>ï¼Œè¿›å…¥å†å²è®°å½• <a href=https://www.bilibili.com/account/history>https://www.bilibili.com/account/history</a></p></li><li><p>åœ¨ç½‘é¡µä»»æ„ä½ç½®ï¼Œé¼ æ ‡å³é”® <code>æ£€æŸ¥</code></p></li></ol><p><img src=https://ws1.sinaimg.cn/large/c3a916a7gy1fzfkf5qyuqj20c009g765.jpg alt></p><ol start=4><li>æŒ‰ç…§ä¸‹å›¾æ‰€ç¤ºï¼Œè¿›å…¥ <code>Network</code> é¡µé¢ï¼Œç­›é€‰æ¡†è¾“å…¥ <code>history</code>ï¼Œå¯¹ç»“æœè¿›è¡Œç­›é€‰ï¼Œé¡µé¢æ»šè½®å¾€ä¸‹å³å¯çœ‹åˆ°æµè§ˆè¿‡ç¨‹ä¸­çš„å†å²è®°å½•è¯·æ±‚çš„ <code>Header</code></li></ol><p><img src=https://ws1.sinaimg.cn/large/c3a916a7gy1fzfkc5s8scj21ga0nok4i.jpg alt></p><ol start=5><li>å°† Header ä¸‹ï¼Œ cookie ä¸€è¡Œçš„å­—ç¬¦ä¸²å¤åˆ¶å‡ºæ¥åˆ°ä¸€ä¸ª <code>cookie.txt</code> æ–‡æœ¬é‡Œ</li></ol><p><img src=https://ws1.sinaimg.cn/large/c3a916a7gy1fzfkkj1adsj20ta07ita2.jpg alt></p><h2 id=python-ä»£ç å®ç°>Python ä»£ç å®ç°</h2><ul><li>ä¼ªé€ æµè§ˆå™¨è¯·æ±‚</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>import</span> json
<span style=color:#f92672>import</span> requests


<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>read_cookies_file</span>(filename):
    <span style=color:#e6db74>&#34;&#34;&#34;read cookie txt file
</span><span style=color:#e6db74>    :param filename: (str) cookies file path
</span><span style=color:#e6db74>    :return: (dict) cookies
</span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
    <span style=color:#66d9ef>with</span> open(filename, <span style=color:#e6db74>&#39;r&#39;</span>) <span style=color:#66d9ef>as</span> fp:
        cookies <span style=color:#f92672>=</span> fp<span style=color:#f92672>.</span>read()
        <span style=color:#66d9ef>return</span> cookies


<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_header</span>(filename):
    cookie <span style=color:#f92672>=</span> read_cookies_file(filename)
    headers <span style=color:#f92672>=</span> {
        <span style=color:#e6db74>&#39;Accept&#39;</span>: <span style=color:#e6db74>&#39;*/*&#39;</span>,
        <span style=color:#e6db74>&#39;Accept-Encoding&#39;</span>: <span style=color:#e6db74>&#39;gzip, deflate, br&#39;</span>,
        <span style=color:#e6db74>&#39;Accept-Language&#39;</span>: <span style=color:#e6db74>&#39;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&#39;</span>,
        <span style=color:#e6db74>&#39;Connection&#39;</span>: <span style=color:#e6db74>&#39;keep-alive&#39;</span>,
        <span style=color:#e6db74>&#39;Cookie&#39;</span>: cookie,
        <span style=color:#e6db74>&#39;Host&#39;</span>: <span style=color:#e6db74>&#39;api.bilibili.com&#39;</span>,
        <span style=color:#e6db74>&#39;Referer&#39;</span>: <span style=color:#e6db74>&#39;https://www.bilibili.com/account/history&#39;</span>,
        <span style=color:#e6db74>&#39;User-Agent&#39;</span>: <span style=color:#e6db74>&#39;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_2) AppleWebKit/537.36 &#39;</span>
                      <span style=color:#e6db74>&#39;(KHTML, like Gecko) Chrome/71.0.3578.98 Safari/537.36&#39;</span>
    }
    <span style=color:#66d9ef>return</span> headers


<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>req_get</span>(headers, url):
    resp <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>get(url, headers<span style=color:#f92672>=</span>headers)
    <span style=color:#66d9ef>return</span> json<span style=color:#f92672>.</span>loads(resp<span style=color:#f92672>.</span>text)
</code></pre></div><ul><li>ä½¿ç”¨ cookie æ¨¡æ‹Ÿè¯·æ±‚</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_all_bili_history</span>(cookie_file):
    headers <span style=color:#f92672>=</span> bilibili<span style=color:#f92672>.</span>get_header(cookie_file)
    history <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#39;all&#39;</span>: []}
    <span style=color:#66d9ef>for</span> page_num <span style=color:#f92672>in</span> range(MAX_PAGE):
        time<span style=color:#f92672>.</span>sleep(<span style=color:#ae81ff>0.6</span>)
        url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;https://api.bilibili.com/x/v2/history?pn={pn}&amp;ps={ps}&amp;jsonp=jsonp&#39;</span><span style=color:#f92672>.</span>format(pn<span style=color:#f92672>=</span>page_num, ps<span style=color:#f92672>=</span>PAGE_PER_NUM)
        result <span style=color:#f92672>=</span> bilibili<span style=color:#f92672>.</span>req_get(headers, url)
        <span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#39;page = {} code = {} datalen = {}&#39;</span><span style=color:#f92672>.</span>format(page_num, result[<span style=color:#e6db74>&#39;code&#39;</span>], len(result[<span style=color:#e6db74>&#39;data&#39;</span>])))
        <span style=color:#66d9ef>if</span> len(result[<span style=color:#e6db74>&#39;data&#39;</span>]) <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>:
            <span style=color:#66d9ef>break</span>
        history[<span style=color:#e6db74>&#39;all&#39;</span>]<span style=color:#f92672>.</span>append(result)

    <span style=color:#66d9ef>return</span> history
</code></pre></div><ul><li>ä»£ç éå¸¸ç®€å•ï¼Œå®Œæ•´ä»£ç åœ¨ <a href=https://github.com/wangshub/bilibili-history>https://github.com/wangshub/bilibili-history</a></li></ul><h2 id=å­˜åœ¨çš„é—®é¢˜>å­˜åœ¨çš„é—®é¢˜</h2><ul><li><p>æœ¬æ¥æƒ³æ‹¿åˆ°æ‰€æœ‰çš„æ’­æ”¾è®°å½•ï¼Œåšä¸€äº›ç»Ÿè®¡å’Œé¢„æµ‹ï¼Œä½†æ˜¯ç»è¿‡å®æµ‹ï¼ŒB ç«™åªèƒ½è·å–åˆ°æœ€è¿‘ <code>1000</code> æ¡æˆ–è€…æœ€è¿‘ <code>3</code> ä¸ªæœˆçš„æ’­æ”¾è®°å½•</p></li><li><p>å¦‚æœæƒ³è·å¾—æ›´å¤šï¼Œåªèƒ½åšä¸€ä¸ªç›‘æµ‹ç¨‹åºï¼Œä¸åœåœ°ä»æ¥å£è·å–æ•°æ®</p></li></ul><h2 id=å®‰å…¨é—®é¢˜>å®‰å…¨é—®é¢˜</h2><p>å°½é‡ä¸è¦ä½¿ç”¨ä¸å®‰å…¨çš„ wifi ç½‘ç»œï¼Œæœ‰å¯èƒ½ä¼šè¢«åˆ«æœ‰ç”¨å¿ƒä¹‹äººè·å–ç½‘ç»œè¯·æ±‚çš„ Packageï¼Œæ˜“æ³„éœ²ä¸ªäººéšç§ã€‚</p></div><div class=post-copyright><p class=copyright-item><span>Author:</span>
<span>ç¥å¥‡çš„æˆ˜å£«</span></p><p class=copyright-item><span>Link:</span>
<a href=https://wangshub.github.io/posts/%E7%94%A8python%E8%8E%B7%E5%8F%96b%E7%AB%99%E6%92%AD%E6%94%BE%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BD%95/>https://wangshub.github.io/posts/%E7%94%A8python%E8%8E%B7%E5%8F%96b%E7%AB%99%E6%92%AD%E6%94%BE%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BD%95/</span></p></div><div class=post-tags><section><a href=javascript:window.history.back();>back</a></span> Â·
<span><a href=https://wangshub.github.io>home</a></span></section></div><div class=post-nav><a href=https://wangshub.github.io/posts/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%E7%AD%96%E7%95%A5%E6%A2%AF%E5%BA%A6%E7%AE%97%E6%B3%95/ class=prev rel=prev title=å¼ºåŒ–å­¦ä¹ :ç­–ç•¥æ¢¯åº¦ç®—æ³•><i class="iconfont icon-left"></i>&nbsp;å¼ºåŒ–å­¦ä¹ :ç­–ç•¥æ¢¯åº¦ç®—æ³•</a>
<a href=https://wangshub.github.io/posts/vanilla-policy-gradient/ class=next rel=next title=Vanilla_Policy_Gradient>Vanilla_Policy_Gradient&nbsp;<i class="iconfont icon-right"></i></a></div><div class=post-comment></div></article></div></main><footer class=footer><div class=copyright>&copy;
<span itemprop=copyrightYear>2016 - 2020</span>
<span class=with-love><i class="iconfont icon-love"></i></span><span class=author itemprop=copyrightHolder><a href=https://wangshub.github.io>ç¥å¥‡çš„æˆ˜å£«</a> |</span>
<span>Powered by <a href=https://gohugo.io/ target=_blank rel="external nofollow">Hugo</a> & <a href=https://github.com/Mogeko/Mogege target=_blank rel="external nofollow">Mogege</a></span></div></footer><script defer src=/js/vendor_main.min.js></script><script src=https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin=anonymous></script><script>pangu.spacingPage();</script><script>MathJax={tex:{inlineMath:[["$","$"]],},displayMath:[["$$","$$"],["\[\[","\]\]"],],svg:{fontCache:"global",},};</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></div></body></html>