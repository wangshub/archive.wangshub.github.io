<!doctype html><html lang=zh-cn>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="chrome=1">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=robots content="noodp">
<meta name=author content="ç¥å¥‡çš„æˆ˜å£«">
<link rel=prev href=https://wangshub.github.io/posts/docker-sentry-deploy/>
<link rel=next href=https://wangshub.github.io/posts/about-interpreter/>
<link rel=canonical href=https://wangshub.github.io/posts/camera-pan-tlt-pid-face-tracking/>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png>
<link rel=manifest href=/site.webmanifest>
<link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5>
<meta name=msapplication-TileColor content="#da532c">
<meta name=theme-color content="#ffffff">
<title>
åŸºäº face_recognition å’Œ PID çš„äººè„¸è¯†åˆ«å’Œè·Ÿè¸ª | ğŸ‰ ç¥å¥‡çš„æˆ˜å£«
</title>
<meta name=title content="åŸºäº face_recognition å’Œ PID çš„äººè„¸è¯†åˆ«å’Œè·Ÿè¸ª | ğŸ‰ ç¥å¥‡çš„æˆ˜å£«">
<link rel=stylesheet href=/css/main.min.css>
<script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/wangshub.github.io"},"articleSection":"posts","name":"åŸºäº face_recognition å’Œ PID çš„äººè„¸è¯†åˆ«å’Œè·Ÿè¸ª","headline":"åŸºäº face_recognition å’Œ PID çš„äººè„¸è¯†åˆ«å’Œè·Ÿè¸ª","description":"åŸºäº face_recognition å’Œ PID çš„èˆµæœºäº‘å°äººè„¸è¯†åˆ«å’Œè·Ÿè¸ª å¦‚ä½•è®©æœºå™¨äººå¤´éƒ¨æ‘„åƒå¤´è·Ÿéšè¯†åˆ«åˆ°äººè„¸ä½ç½®å˜åŒ–è€Œè½¬åŠ¨ï¼Ÿä¸€å¸§å›¾åƒæ˜¯ 2 ç»´çš„ï¼Œäººè„¸ä½ç½®ç”¨åæ ‡ (x,y) è¡¨ç¤ºï¼Œè¦å®ç°è·Ÿè¸ªäººè„¸","inLanguage":"zh-cn","author":"ç¥å¥‡çš„æˆ˜å£«","creator":"ç¥å¥‡çš„æˆ˜å£«","publisher":"ç¥å¥‡çš„æˆ˜å£«","accountablePerson":"ç¥å¥‡çš„æˆ˜å£«","copyrightHolder":"ç¥å¥‡çš„æˆ˜å£«","copyrightYear":"2019","datePublished":"2019-06-03 15:42:59 \u002b0000 UTC","dateModified":"2019-06-03 15:42:59 \u002b0000 UTC","url":"https:\/\/wangshub.github.io\/posts\/camera-pan-tlt-pid-face-tracking\/","wordCount":"1538","keywords":["Python","PID","Robot","ğŸ‰ ç¥å¥‡çš„æˆ˜å£«"]}</script>
</head>
<body>
<div class=wrapper>
<nav class=navbar>
<progress class=content_progress max=0 value=0></progress>
<div class=container>
<div class="navbar-header header-back2home-logo">
<span class=logo_mark>>$</span>
<a href=https://wangshub.github.io>
<span class=logo_text>cd /home/</span>
<span class=logo_cursor></span>
</a>
</div>
<div class=navbar-right>
<span class=menu>
<a class=menu-item href=/posts/ title>Blog</a>
<a class=menu-item href=/categories/ title>Categories</a>
<a class=menu-item href=/tags/ title>Tags</a>
<a class=menu-item href=/about/ title>About</a>
<span class=divide></span>
<a href=javascript:void(0); class=theme-switch><i class="iconfont icon-dark-mode"></i></a>
</span>
</div>
</div>
</nav>
<nav class=navbar-mobile id=nav-mobile style=display:none>
<progress class=content_progress max=0 value=0></progress>
<div class=container>
<div class=navbar>
<div class="navbar-header header-logo">
<a href=https://wangshub.github.io>ğŸ‰ ç¥å¥‡çš„æˆ˜å£«</a>
</div>
<div class=navbar-right>
<div><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-dark-mode"></i></a></div>
<div class=menu-toggle>
<span></span><span></span><span></span>
</div>
</div>
</div>
<div class=menu id=mobile-menu>
<nav class=mb-md>
<a class=menu-item href=/posts/ title>
<h3>Blog</h3>
<div class=menu-active></div>
</a>
<a class=menu-item href=/categories/ title>
<h3>Categories</h3>
<div class=menu-active></div>
</a>
<a class=menu-item href=/tags/ title>
<h3>Tags</h3>
<div class=menu-active></div>
</a>
<a class=menu-item href=/about/ title>
<h3>About</h3>
<div class=menu-active></div>
</a>
</nav>
</div>
</div>
</nav>
<main class=main>
<div class=container>
<article class=post-warp itemscope itemtype=http://schema.org/Article>
<header class=post-header>
<h1 class=post-title itemprop="name headline">åŸºäº face_recognition å’Œ PID çš„äººè„¸è¯†åˆ«å’Œè·Ÿè¸ª</h1>
<div class=post-meta>
Written by <a itemprop=name href=https://wangshub.github.io rel=author>ç¥å¥‡çš„æˆ˜å£«</a> with â™¥
<span class=post-time>
on <time datetime=2019-06-03 itemprop=datePublished>June 3, 2019</time>
</span>
in
<span class=post-word-count>1538 words</span>
</div>
</header>
<div class=post-content>
<h1 id=åŸºäº-face_recognition-å’Œ-pid-çš„èˆµæœºäº‘å°äººè„¸è¯†åˆ«å’Œè·Ÿè¸ª>åŸºäº face_recognition å’Œ PID çš„èˆµæœºäº‘å°äººè„¸è¯†åˆ«å’Œè·Ÿè¸ª</h1>
<p>å¦‚ä½•è®©æœºå™¨äººå¤´éƒ¨æ‘„åƒå¤´è·Ÿéšè¯†åˆ«åˆ°äººè„¸ä½ç½®å˜åŒ–è€Œè½¬åŠ¨ï¼Ÿä¸€å¸§å›¾åƒæ˜¯ 2 ç»´çš„ï¼Œäººè„¸ä½ç½®ç”¨åæ ‡ (x,y) è¡¨ç¤ºï¼Œè¦å®ç°è·Ÿè¸ªäººè„¸åˆ™éœ€è¦ä¸¤ä¸ªè½´ <strong>pan, tilt</strong></p>
<ul>
<li><strong>pan</strong>: æ°´å¹³å·¦å³æ–¹å‘è½¬å¤´</li>
<li><strong>tilt</strong>: ç«–ç›´ä¸Šä¸‹æ–¹å‘è½¬å¤´</li>
</ul>
<div style=text-align:center>
<img src=https://raw.githubusercontent.com/wangshub/image-hosting/master/img/20190603155412.png width=30%>
<img src=https://raw.githubusercontent.com/wangshub/image-hosting/master/img/20190603164238.png width=70%>
</div>
<h2 id=äººè„¸è¯†åˆ«>äººè„¸è¯†åˆ«</h2>
<p>é¦–å…ˆéœ€è¦åœ¨æ¯ä¸€å¸§å›¾åƒä¸­è¯†åˆ«åˆ°äººè„¸ï¼Œ<a href=https://github.com/ageitgey/face_recognition>face_recognition</a> ä¸€ä¸ªç®€å•æ˜“ç”¨çš„äººè„¸è¯†åˆ«å¼€æºé¡¹ç›®ï¼Œå¹¶ä¸”é…å¤‡äº†å®Œæ•´çš„å¼€å‘æ–‡æ¡£å’Œç¤ºä¾‹ä»£ç ï¼Œè¿˜ç‰¹åˆ«å…¼å®¹äº†æ ‘è“æ´¾ã€‚face_recognition åŸºäº C++ å¼€æºåº“ dlib çš„æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œä½¿ç”¨ <a href=http://vis-www.cs.umass.edu/lfw/>Labeled Faces in the Wild</a> äººè„¸æ•°æ®é›†è¿›è¡Œæµ‹è¯•ï¼Œæœ‰é«˜è¾¾99.38%çš„å‡†ç¡®ç‡ã€‚</p>
<h3 id=å®‰è£…-face_recognition>å®‰è£… face_recognition</h3>
<p>å®‰è£…æ­¥éª¤è¯·å‚è€ƒ: <a href=https://github.com/ageitgey/face_recognition#installation>face_recognition#installation</a></p>
<h3 id=è¯†åˆ«äººè„¸-python-ä»£ç >è¯†åˆ«äººè„¸ Python ä»£ç </h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Python data-lang=Python><span style=color:#f92672>import</span> face_recognition

<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>face_location</span>(frame, frame_center):
    face_locations <span style=color:#f92672>=</span> face_recognition<span style=color:#f92672>.</span>face_locations(frame)
    <span style=color:#66d9ef>if</span> len(face_locations) <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>:
        y0, x0, y1, x1 <span style=color:#f92672>=</span> face_locations[<span style=color:#ae81ff>0</span>]
        face_x <span style=color:#f92672>=</span> int((x0 <span style=color:#f92672>+</span> x1) <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>)
        face_y <span style=color:#f92672>=</span> int((y0 <span style=color:#f92672>+</span> y1) <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>)
        <span style=color:#66d9ef>return</span> face_x, face_y
    <span style=color:#66d9ef>return</span> frame_center
</code></pre></div><h2 id=pid-æ§åˆ¶>PID æ§åˆ¶</h2>
<p>ä½¿ç”¨ face_recognition å¯ä»¥å¾ˆå®¹æ˜“åœ°ç”¨ Python ä»£ç å®ç°äººè„¸è¯†åˆ«ï¼Œè®¡ç®—å‡ºäººè„¸åœ¨ä¸€å¸§å›¾åƒä¸­çš„åƒç´ åæ ‡ <code>(x, y)</code>ï¼Œæ¥ä¸‹æ¥å°±æ˜¯éœ€è¦æ§åˆ¶èˆµæœºå¯¹äººè„¸è¿›è¡Œè·Ÿè¸ªã€‚</p>
<p><strong>æ§åˆ¶ç›®æ ‡</strong>ï¼š<strong>è°ƒæ•´æ¨ªå‘å’Œçºµå‘ä¸¤ä¸ªè‡ªç”±åº¦çš„èˆµæœºï¼Œä½¿å¾—æ‘„åƒå¤´ä¸­çš„äººè„¸ä¸­å¿ƒä¸å›¾åƒçš„ä¸­å¿ƒé‡åˆã€‚</strong></p>
<p>è¿™å°±éœ€è¦å¼•å…¥ PID æ§åˆ¶äº†ï¼Œå…ˆç›´æ¥æ”¾å…¬å¼</p>
<div>
$$
u(t)=K_{\mathrm{p}} e(t)+K_{\mathrm{i}} \int_{0}^{t} e\left(t^{\prime}\right) d t^{\prime}+K_{\mathrm{d}} \frac{d e(t)}{d t}
$$
</div>
<ul>
<li><strong>æ—¶é—´</strong> $t$ï¼Œåœ¨è¿™é‡Œæ—¶é—´æ˜¯ç¦»æ•£çš„ï¼›</li>
<li><strong>åå·®</strong> $e(t)$ï¼Œåœ¨äººè„¸è·Ÿè¸ªä¸­æŒ‡çš„æ˜¯å›¾åƒä¸­å¿ƒä¸äººè„¸ä¸­å¿ƒä¹‹é—´çš„è·ç¦»ï¼ˆx æ–¹å‘ï¼Œy æ–¹å‘ï¼‰ï¼›</li>
<li><strong>ç³»ç»Ÿè¾“å‡º</strong> $u(t)$ï¼Œå³è¾“å‡ºçš„èˆµæœºè§’åº¦(åˆ†æ°´å¹³å’Œå‚ç›´æ–¹å‘ä¸¤ä¸ªèˆµæœºçš„è§’åº¦)ï¼›</li>
</ul>
<p>æ¥ä¸‹æ¥éœ€è¦ç†è§£ï¼Œ$K_p$ï¼Œ$K_i$ï¼Œ$K_d$ ä¸‰ä¸ªå‚æ•°çš„ä½œç”¨</p>
<h3 id=æ¯”ä¾‹p>æ¯”ä¾‹(P)</h3>
<p>æ¯”ä¾‹æ§åˆ¶çš„è¾“å‡ºä¿¡å·ä¸è¾“å…¥åå·®æˆæ¯”ä¾‹å…³ç³»ã€‚åå·®ä¸€æ—¦äº§ç”Ÿï¼Œæ§åˆ¶å™¨ç«‹å³äº§ç”Ÿæ§åˆ¶ä½œç”¨ä»¥å‡å°åå·®ï¼Œæ˜¯æœ€åŸºæœ¬çš„æ§åˆ¶è§„å¾‹ã€‚å½“ä»…æœ‰æ¯”ä¾‹æ§åˆ¶æ—¶ç³»ç»Ÿè¾“å‡ºå­˜åœ¨ç¨³æ€è¯¯å·®ã€‚</p>
<ul>
<li>å½“äººè„¸ä¸å›¾åƒä¸­å¿ƒç›¸è·<strong>è¾ƒè¿œ</strong>æ—¶ï¼Œéœ€è¦èˆµæœº<strong>å¤§å¹…åº¦</strong>è¿åŠ¨å¯¹å‡†äººè„¸</li>
<li>å½“äººè„¸ä¸å›¾åƒä¸­å¿ƒç›¸è·<strong>è¾ƒè¿‘</strong>æ—¶ï¼Œéœ€è¦èˆµæœº<strong>å°å¹…åº¦</strong>é è¿‘å¯¹å‡†äººè„¸</li>
</ul>
<p>æ ¹æ® <code>kp</code> å–å€¼ä¸åŒï¼Œæ‘„åƒå¤´éƒ½ä¼šå»å¯¹å‡†äººè„¸ï¼Œåªæ˜¯ <code>kp</code> å¤§äº†åˆ°è¾¾çš„å¿«ï¼Œ<code>kp</code> å°äº†åˆ°è¾¾çš„æ…¢ä¸€äº›ã€‚</p>
<h3 id=ç§¯åˆ†i>ç§¯åˆ†(I)</h3>
<p>é˜²æ­¢ç³»ç»Ÿè¿›å…¥ç¨³å®šåå­˜åœ¨çš„ç¨³å®šè¯¯å·®ï¼Œå³æœ‰å¯èƒ½æ‘„åƒå¤´ç¨³å®šååœä¸‹æ¥äº†ï¼Œä½†æ˜¯æ²¡æœ‰å¯¹å‡†äººè„¸çš„ä¸­å¿ƒã€‚ä¸ºäº†æ¶ˆé™¤ç¨³æ€è¯¯å·®ï¼Œå¿…é¡»å¼•å…¥ç§¯åˆ†æ§åˆ¶ã€‚ç§¯åˆ†ä½œç”¨æ˜¯å¯¹å†å²çš„åå·®è¿›è¡Œç§¯åˆ†ï¼Œéšç€æ—¶é—´çš„å¢åŠ ï¼Œç§¯åˆ†è¾“å‡ºä¼šå¢å¤§ï¼Œä½¿ç¨³æ€è¯¯å·®è¿›ä¸€æ­¥å‡å°ï¼Œç›´åˆ°åå·®ä¸ºé›¶ï¼Œæ‰ä¸å†ç»§ç»­å¢åŠ ï¼Œæœ€åç³»ç»Ÿç¨³å®šä¸‹æ¥ï¼Œæ‰å¯èƒ½æ­£å¥½ä¸­å¿ƒå¯¹å‡†äººè„¸ã€‚</p>
<h3 id=å¾®åˆ†d>å¾®åˆ†(D)</h3>
<p>åœ¨å¾®åˆ†æ§åˆ¶ä¸­ï¼Œæ§åˆ¶å™¨çš„è¾“å‡ºä¸è¾“å…¥åå·®ä¿¡å·çš„å¾®åˆ†(å³åå·®çš„å˜åŒ–ç‡)æˆæ­£æ¯”å…³ç³»ã€‚å¾®åˆ†æ§åˆ¶åæ˜ åå·®çš„å˜åŒ–ç‡ï¼Œåªæœ‰å½“åå·®éšæ—¶é—´å˜åŒ–æ—¶ï¼Œå¾®åˆ†æ§åˆ¶æ‰ä¼šå¯¹ç³»ç»Ÿèµ·ä½œç”¨ï¼Œè€Œå¯¹æ— å˜åŒ–æˆ–ç¼“æ…¢å˜åŒ–çš„å¯¹è±¡ä¸èµ·ä½œç”¨ã€‚é€šä¿—æ¥è¯´ï¼Œæ˜¯ä¸ºäº†åœ¨äººè„¸è¿½è¸ªæ—¶ï¼Œé˜²æ­¢<strong>è¿½è¿‡åŠ²äº†</strong>ï¼Œåœ¨ä¸­å¿ƒå¯¹å‡†äººè„¸åå¯ä»¥åŠæ—¶åœ°åœæ­¢ï¼Œé˜²æ­¢éœ‡è¡ã€‚</p>
<h3 id=pid-ä»£ç å®ç°>PID ä»£ç å®ç°</h3>
<p>åœ¨ç†è§£æ¦‚å¿µå’Œå…¬å¼åï¼Œå°±ä¸éš¾ä»£ç å®ç°</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Python data-lang=Python><span style=color:#75715e># https://www.pyimagesearch.com/2019/04/01/pan-tilt-face-tracking-with-a-raspberry-pi-and-opencv/</span>
<span style=color:#f92672>import</span> time

<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PID</span>:
    <span style=color:#66d9ef>def</span> __init__(self, kP<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>, kI<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>, kD<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>):
        <span style=color:#75715e># initialize gains</span>
        self<span style=color:#f92672>.</span>kP <span style=color:#f92672>=</span> kP
        self<span style=color:#f92672>.</span>kI <span style=color:#f92672>=</span> kI
        self<span style=color:#f92672>.</span>kD <span style=color:#f92672>=</span> kD

    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>initialize</span>(self):
        <span style=color:#75715e># intialize the current and previous time</span>
        self<span style=color:#f92672>.</span>currTime <span style=color:#f92672>=</span> time<span style=color:#f92672>.</span>time()
        self<span style=color:#f92672>.</span>prevTime <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>currTime

        <span style=color:#75715e># initialize the previous error</span>
        self<span style=color:#f92672>.</span>prevError <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>

        <span style=color:#75715e># initialize the term result variables</span>
        self<span style=color:#f92672>.</span>cP <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
        self<span style=color:#f92672>.</span>cI <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
        self<span style=color:#f92672>.</span>cD <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>

    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>update</span>(self, error, sleep<span style=color:#f92672>=</span><span style=color:#ae81ff>0.2</span>):
        <span style=color:#75715e># pause for a bit</span>
        time<span style=color:#f92672>.</span>sleep(sleep)

        <span style=color:#75715e># grab the current time and calculate delta time</span>
        self<span style=color:#f92672>.</span>currTime <span style=color:#f92672>=</span> time<span style=color:#f92672>.</span>time()
        deltaTime <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>currTime <span style=color:#f92672>-</span> self<span style=color:#f92672>.</span>prevTime

        <span style=color:#75715e># delta error</span>
        deltaError <span style=color:#f92672>=</span> error <span style=color:#f92672>-</span> self<span style=color:#f92672>.</span>prevError

        <span style=color:#75715e># proportional term</span>
        self<span style=color:#f92672>.</span>cP <span style=color:#f92672>=</span> error

        <span style=color:#75715e># integral term</span>
        self<span style=color:#f92672>.</span>cI <span style=color:#f92672>+=</span> error <span style=color:#f92672>*</span> deltaTime

        <span style=color:#75715e># derivative term and prevent divide by zero</span>
        self<span style=color:#f92672>.</span>cD <span style=color:#f92672>=</span> (deltaError <span style=color:#f92672>/</span> deltaTime) <span style=color:#66d9ef>if</span> deltaTime <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>else</span> <span style=color:#ae81ff>0</span>

        <span style=color:#75715e># save previous time and error for the next update</span>
        self<span style=color:#f92672>.</span>prevTime <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>currTime
        self<span style=color:#f92672>.</span>prevError <span style=color:#f92672>=</span> error

        <span style=color:#75715e># sum the terms and return</span>
        <span style=color:#66d9ef>return</span> sum([
            self<span style=color:#f92672>.</span>kP <span style=color:#f92672>*</span> self<span style=color:#f92672>.</span>cP,
            self<span style=color:#f92672>.</span>kI <span style=color:#f92672>*</span> self<span style=color:#f92672>.</span>cI,
            self<span style=color:#f92672>.</span>kD <span style=color:#f92672>*</span> self<span style=color:#f92672>.</span>cD])

</code></pre></div><h2 id=ä»£ç è®¾è®¡>ä»£ç è®¾è®¡</h2>
<p>ç”±äºäº‘å°æœ‰ 2 ä¸ªè‡ªç”±åº¦ï¼ˆpan, tiltï¼‰ï¼Œæ‰€ä»¥éœ€è¦ç”¨åˆ° 2 ä¸ª PID æ§åˆ¶å™¨ï¼Œæ¥è¾“å‡ºå¯¹åº”çš„è§’åº¦</p>
<ul>
<li>$x$ è½´åå·® å¯¹åº” æ°´å¹³å·¦å³è½¬åŠ¨ <strong>pan</strong></li>
<li>$y$ è½´åå·® å¯¹åº” å‚ç›´ä¸Šä¸‹è½¬åŠ¨ <strong>tilt</strong></li>
</ul>
<p>åœ¨ä»£ç è®¾è®¡æ—¶ï¼Œéœ€è¦è€ƒè™‘å¦‚ä¸‹å‡ ç‚¹é™åˆ¶å› ç´ </p>
<ul>
<li>å—é™äºè®¾å¤‡çš„æ€§èƒ½ï¼Œä½¿ç”¨ face_recognition è¯†åˆ«ä¸€å¸§å›¾åƒé‡Œçš„äººè„¸å¯èƒ½ä¼šéå¸¸è€—æ—¶</li>
<li>èˆµæœºæ§åˆ¶æ—¶ï¼Œä¸åŒçš„èˆµæœºå“åº”æ—¶é—´ä¸åŒ</li>
<li>PID åœ¨ä»£ç ä¸­æ˜¯é€šè¿‡å¾ªç¯ç´¯åŠ æ¥è®¡ç®—çš„ï¼›</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>thread_face_center</span>():
    print(<span style=color:#e6db74>&#39;face_center ..&#39;</span>)
    process_this_frame <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
    <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
        time<span style=color:#f92672>.</span>sleep(<span style=color:#ae81ff>0.01</span>)
        <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> QUEUE_IMG<span style=color:#f92672>.</span>empty():
            frame <span style=color:#f92672>=</span> QUEUE_IMG<span style=color:#f92672>.</span>get()
        <span style=color:#66d9ef>else</span>:
            <span style=color:#66d9ef>continue</span>

        (h, w) <span style=color:#f92672>=</span> frame<span style=color:#f92672>.</span>shape[:<span style=color:#ae81ff>2</span>]
        HEAD<span style=color:#f92672>.</span>center_x <span style=color:#f92672>=</span> w <span style=color:#f92672>//</span> <span style=color:#ae81ff>2</span>
        HEAD<span style=color:#f92672>.</span>center_y <span style=color:#f92672>=</span> h <span style=color:#f92672>//</span> <span style=color:#ae81ff>2</span>

        <span style=color:#66d9ef>if</span> process_this_frame <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>8</span>:
            HEAD<span style=color:#f92672>.</span>obj_x, HEAD<span style=color:#f92672>.</span>obj_y <span style=color:#f92672>=</span> face_location(frame, (HEAD<span style=color:#f92672>.</span>center_x, HEAD<span style=color:#f92672>.</span>center_y))
            print(HEAD<span style=color:#f92672>.</span>obj_x, HEAD<span style=color:#f92672>.</span>obj_y)
            process_this_frame <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
        process_this_frame <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>


<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>thread_pid_pan</span>():
    p, i, d <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.09</span>, <span style=color:#ae81ff>0.08</span>, <span style=color:#ae81ff>0.002</span>

    pid <span style=color:#f92672>=</span> PID(p, i, d)
    pid<span style=color:#f92672>.</span>initialize()
    <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
        error <span style=color:#f92672>=</span> HEAD<span style=color:#f92672>.</span>center_x <span style=color:#f92672>-</span> HEAD<span style=color:#f92672>.</span>obj_x
        HEAD<span style=color:#f92672>.</span>pan <span style=color:#f92672>=</span> pid<span style=color:#f92672>.</span>update(error)


<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>thread_pid_tlt</span>():
    p, i, d <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.11</span>, <span style=color:#ae81ff>0.10</span>, <span style=color:#ae81ff>0.002</span>

    pid <span style=color:#f92672>=</span> PID(p, i, d)
    pid<span style=color:#f92672>.</span>initialize()
    <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
        error <span style=color:#f92672>=</span> HEAD<span style=color:#f92672>.</span>center_y <span style=color:#f92672>-</span> HEAD<span style=color:#f92672>.</span>obj_y
        HEAD<span style=color:#f92672>.</span>tlt <span style=color:#f92672>=</span> pid<span style=color:#f92672>.</span>update(error)

<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>thread_set_servos</span>():
    set_head_servo([<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>90</span>])
    <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
        time<span style=color:#f92672>.</span>sleep(<span style=color:#ae81ff>0.01</span>)
        pan_angle <span style=color:#f92672>=</span> HEAD<span style=color:#f92672>.</span>pan <span style=color:#f92672>+</span> <span style=color:#ae81ff>0</span>
        tlt_angle <span style=color:#f92672>=</span> <span style=color:#ae81ff>90</span> <span style=color:#f92672>-</span> HEAD<span style=color:#f92672>.</span>tlt
        print(<span style=color:#e6db74>&#39;[pan_angle, tlt_angle] = &#39;</span>, pan_angle, tlt_angle)
        set_head_servo([pan_angle, tlt_angle])

</code></pre></div><p>éœ€è¦å°†äººè„¸è¯†åˆ«ã€PID è¿‡ç¨‹ã€è§’åº¦æ§åˆ¶æ”¾åˆ°<strong>å•ç‹¬çš„çº¿ç¨‹</strong>å¤„ç†ã€‚</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>async_do_job(thread_face_center)
async_do_job(thread_pid_pan)
async_do_job(thread_pid_tlt)
async_do_job(thread_set_servos)
</code></pre></div><h2 id=å‚è€ƒé“¾æ¥>å‚è€ƒé“¾æ¥</h2>
<ul>
<li><a href=https://zh.wikipedia.org/wiki/PID%E6%8E%A7%E5%88%B6%E5%99%A8>Wikipedia: PID æ§åˆ¶å™¨</a></li>
<li><a href=https://github.com/ageitgey/face_recognition>The world&rsquo;s simplest facial recognition api for Python and the command line</a></li>
<li><a href=https://www.pyimagesearch.com/2019/04/01/pan-tilt-face-tracking-with-a-raspberry-pi-and-opencv/>Pan/tilt face tracking with a Raspberry Pi and OpenCV</a></li>
</ul>
</div>
<div class=post-copyright>
<p class=copyright-item>
<span>Author:</span>
<span>ç¥å¥‡çš„æˆ˜å£« </span>
</p>
<p class=copyright-item>
<span>Link:</span>
<a href=https://wangshub.github.io/posts/camera-pan-tlt-pid-face-tracking/>https://wangshub.github.io/posts/camera-pan-tlt-pid-face-tracking/</span>
</p>
</div>
<div class=post-tags>
<section>
<i class="iconfont icon-tag"></i>Tag(s):
<span class=tag><a href=https://wangshub.github.io/tags/python/>
#Python</a></span>
<span class=tag><a href=https://wangshub.github.io/tags/pid/>
#PID</a></span>
<span class=tag><a href=https://wangshub.github.io/tags/robot/>
#Robot</a></span>
</section>
<section>
<a href=javascript:window.history.back();>back</a></span> Â·
<span><a href=https://wangshub.github.io>home</a></span>
</section>
</div>
<div class=post-nav>
<a href=https://wangshub.github.io/posts/docker-sentry-deploy/ class=prev rel=prev title="ç”¨ Docker éƒ¨ç½² Sentry Bug æ—¥å¿—æ”¶é›†æœåŠ¡"><i class="iconfont icon-left"></i>&nbsp;ç”¨ Docker éƒ¨ç½² Sentry Bug æ—¥å¿—æ”¶é›†æœåŠ¡</a>
<a href=https://wangshub.github.io/posts/about-interpreter/ class=next rel=next title=ä¸¤ç§ç¡¬ä»¶ç¼–ç¨‹çš„é£æ ¼ï¼šç¦»çº¿ä¸‹è½½å’Œåœ¨çº¿äº¤äº’>ä¸¤ç§ç¡¬ä»¶ç¼–ç¨‹çš„é£æ ¼ï¼šç¦»çº¿ä¸‹è½½å’Œåœ¨çº¿äº¤äº’&nbsp;<i class="iconfont icon-right"></i></a>
</div>
<div class=post-comment>
</div>
</article>
</div>
</main>
<footer class=footer>
<div class=copyright>
&copy;
<span itemprop=copyrightYear>2016 - 2021</span>
<span class=with-love>
<i class="iconfont icon-love"></i>
</span>
<span class=author itemprop=copyrightHolder><a href=https://wangshub.github.io>ç¥å¥‡çš„æˆ˜å£«</a> | </span>
<span>Powered by <a href=https://gohugo.io/ target=_blank rel="external nofollow">Hugo</a> & <a href=https://github.com/Mogeko/Mogege target=_blank rel="external nofollow">Mogege</a></span>
</div>
</footer>
<script defer src=/js/vendor_main.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin=anonymous></script>
<script>pangu.spacingPage()</script>
</div>
</body>
</html>