<!doctype html><html lang=zh-cn>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="chrome=1">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=robots content="noodp">
<meta name=author content="神奇的战士">
<link rel=prev href=https://wangshub.github.io/posts/python-mail-sender/>
<link rel=next href=https://wangshub.github.io/posts/python%E6%95%B0%E5%AD%97%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86-%E5%9B%BE%E5%83%8F%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84%E5%92%8C%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/>
<link rel=canonical href=https://wangshub.github.io/posts/python-check-hosts-update/>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png>
<link rel=manifest href=/site.webmanifest>
<link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5>
<meta name=msapplication-TileColor content="#da532c">
<meta name=theme-color content="#ffffff">
<title>
python check hosts update | 🍉 神奇的战士
</title>
<meta name=title content="python check hosts update | 🍉 神奇的战士">
<link rel=stylesheet href=/css/main.min.css>
<script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/wangshub.github.io"},"articleSection":"posts","name":"python check hosts update","headline":"python check hosts update","description":"用Python检查 hosts 更新 最近各种代理纷纷关闭，常见的翻墙方式就剩lantern和更改hosts的方式依旧坚挺，关注了一些更新hosts的gi","inLanguage":"zh-cn","author":"神奇的战士","creator":"神奇的战士","publisher":"神奇的战士","accountablePerson":"神奇的战士","copyrightHolder":"神奇的战士","copyrightYear":"2017","datePublished":"2017-07-20 22:33:15 \u002b0000 UTC","dateModified":"2017-07-20 22:33:15 \u002b0000 UTC","url":"https:\/\/wangshub.github.io\/posts\/python-check-hosts-update\/","wordCount":"257","keywords":["Python","VPN","🍉 神奇的战士"]}</script>
</head>
<body>
<div class=wrapper>
<nav class=navbar>
<progress class=content_progress max=0 value=0></progress>
<div class=container>
<div class="navbar-header header-back2home-logo">
<span class=logo_mark>>$</span>
<a href=https://wangshub.github.io>
<span class=logo_text>cd /home/</span>
<span class=logo_cursor></span>
</a>
</div>
<div class=navbar-right>
<span class=menu>
<a class=menu-item href=/posts/ title>Blog</a>
<a class=menu-item href=/categories/ title>Categories</a>
<a class=menu-item href=/tags/ title>Tags</a>
<a class=menu-item href=/about/ title>About</a>
<span class=divide></span>
<a href=javascript:void(0); class=theme-switch><i class="iconfont icon-dark-mode"></i></a>
</span>
</div>
</div>
</nav>
<nav class=navbar-mobile id=nav-mobile style=display:none>
<progress class=content_progress max=0 value=0></progress>
<div class=container>
<div class=navbar>
<div class="navbar-header header-logo">
<a href=https://wangshub.github.io>🍉 神奇的战士</a>
</div>
<div class=navbar-right>
<div><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-dark-mode"></i></a></div>
<div class=menu-toggle>
<span></span><span></span><span></span>
</div>
</div>
</div>
<div class=menu id=mobile-menu>
<nav class=mb-md>
<a class=menu-item href=/posts/ title>
<h3>Blog</h3>
<div class=menu-active></div>
</a>
<a class=menu-item href=/categories/ title>
<h3>Categories</h3>
<div class=menu-active></div>
</a>
<a class=menu-item href=/tags/ title>
<h3>Tags</h3>
<div class=menu-active></div>
</a>
<a class=menu-item href=/about/ title>
<h3>About</h3>
<div class=menu-active></div>
</a>
</nav>
</div>
</div>
</nav>
<main class=main>
<div class=container>
<article class=post-warp itemscope itemtype=http://schema.org/Article>
<header class=post-header>
<h1 class=post-title itemprop="name headline">python check hosts update</h1>
<div class=post-meta>
Written by <a itemprop=name href=https://wangshub.github.io rel=author>神奇的战士</a> with ♥
<span class=post-time>
on <time datetime=2017-07-20 itemprop=datePublished>July 20, 2017</time>
</span>
in
<i class="iconfont icon-folder"></i>
<span class=post-category>
<a href=https://wangshub.github.io/categories/python/> Python, </a>
<a href=https://wangshub.github.io/categories/vpn/> VPN, </a>
</span>
<span class=post-word-count>257 words</span>
</div>
</header>
<div class=post-content>
<h1 id=用python检查-_hosts_-更新>用Python检查 <em>hosts</em> 更新</h1>
<p>最近各种代理纷纷关闭，常见的翻墙方式就剩lantern和更改hosts的方式依旧坚挺，关注了一些更新hosts的git仓库，但是又不想登录网页查看原作者是否有更新。所以这种苦力活就让Python干好了。</p>
<h2 id=hosts地址>hosts地址</h2>
<p><em>hosts_info.py</em></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>hosts_source <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;https://raw.githubusercontent.com/racaljk/hosts/master/hosts&#34;</span>]
</code></pre></div><h2 id=检查hosts是否有更新>检查hosts是否有更新</h2>
<p><em>check_hosts.py</em></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>import</span> urllib2
<span style=color:#f92672>from</span> .hosts_info <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
<span style=color:#f92672>import</span> os
<span style=color:#f92672>import</span> filecmp


<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>hosts_download</span>():
    <span style=color:#66d9ef>if</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>exists(<span style=color:#e6db74>&#39;hosts&#39;</span>):
        hosts_name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;hosts_new&#39;</span>
    <span style=color:#66d9ef>else</span>:
        hosts_name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;hosts&#39;</span>

    <span style=color:#75715e># todo: overtime detection</span>
    f <span style=color:#f92672>=</span> urllib2<span style=color:#f92672>.</span>urlopen(hosts_source[<span style=color:#ae81ff>0</span>])
    print <span style=color:#e6db74>&#34;downloading hosts&#34;</span>
    <span style=color:#66d9ef>with</span> open(hosts_name, <span style=color:#e6db74>&#34;wb&#34;</span>) <span style=color:#66d9ef>as</span> code:
       code<span style=color:#f92672>.</span>write(f<span style=color:#f92672>.</span>read())

<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>is_hosts_new</span>():

    hosts_download()

    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>exists(<span style=color:#e6db74>&#39;hosts&#39;</span>):
        print <span style=color:#e6db74>&#39;oops, hosts not exists&#39;</span>
        <span style=color:#66d9ef>return</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>

    <span style=color:#66d9ef>elif</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>exists(<span style=color:#e6db74>&#39;hosts&#39;</span>) <span style=color:#f92672>and</span> (<span style=color:#f92672>not</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>exists(<span style=color:#e6db74>&#39;hosts_new&#39;</span>)):
        print <span style=color:#e6db74>&#39;first run, only one hosts file&#39;</span>
        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>True</span>

    <span style=color:#66d9ef>elif</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>exists(<span style=color:#e6db74>&#39;hosts&#39;</span>) <span style=color:#f92672>and</span> (os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>exists(<span style=color:#e6db74>&#39;hosts_new&#39;</span>)):
        print <span style=color:#e6db74>&#39;compare hosts &amp; hosts_new&#39;</span>
        diff_status <span style=color:#f92672>=</span> filecmp<span style=color:#f92672>.</span>cmp(<span style=color:#e6db74>&#39;hosts&#39;</span>, <span style=color:#e6db74>&#39;hosts_new&#39;</span>)
        <span style=color:#66d9ef>if</span> diff_status:
            print <span style=color:#e6db74>&#39;same file&#39;</span>
            os<span style=color:#f92672>.</span>remove(<span style=color:#e6db74>&#39;hosts_new&#39;</span>)
            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span>
        <span style=color:#66d9ef>else</span>:
            print <span style=color:#e6db74>&#39;diff file&#39;</span>
            os<span style=color:#f92672>.</span>remove(<span style=color:#e6db74>&#39;hosts&#39;</span>)
            os<span style=color:#f92672>.</span>rename(<span style=color:#e6db74>&#39;hosts_new&#39;</span>, <span style=color:#e6db74>&#34;hosts&#34;</span>)
            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>True</span>
    <span style=color:#66d9ef>else</span>:
        <span style=color:#66d9ef>return</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>
</code></pre></div><h2 id=主程序调用>主程序调用</h2>
<p><em>main.py</em></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>from</span> check_hosts.check_hosts <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>

diff_status <span style=color:#f92672>=</span> is_hosts_new()
<span style=color:#66d9ef>if</span> diff_status:
    print <span style=color:#e6db74>&#34;new hosts !&#34;</span>
<span style=color:#66d9ef>else</span>:
    print <span style=color:#e6db74>&#39;code: &#39;</span>,diff_status

</code></pre></div>
</div>
<div class=post-copyright>
<p class=copyright-item>
<span>Author:</span>
<span>神奇的战士 </span>
</p>
<p class=copyright-item>
<span>Link:</span>
<a href=https://wangshub.github.io/posts/python-check-hosts-update/>https://wangshub.github.io/posts/python-check-hosts-update/</span>
</p>
</div>
<div class=post-tags>
<section>
<i class="iconfont icon-tag"></i>Tag(s):
<span class=tag><a href=https://wangshub.github.io/tags/python/>
#Python</a></span>
<span class=tag><a href=https://wangshub.github.io/tags/vpn/>
#VPN</a></span>
</section>
<section>
<a href=javascript:window.history.back();>back</a></span> ·
<span><a href=https://wangshub.github.io>home</a></span>
</section>
</div>
<div class=post-nav>
<a href=https://wangshub.github.io/posts/python-mail-sender/ class=prev rel=prev title="python mail sender"><i class="iconfont icon-left"></i>&nbsp;python mail sender</a>
<a href=https://wangshub.github.io/posts/python%E6%95%B0%E5%AD%97%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86-%E5%9B%BE%E5%83%8F%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84%E5%92%8C%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/ class=next rel=next title=python数字图像处理-图像的基本结构和基础知识>python数字图像处理-图像的基本结构和基础知识&nbsp;<i class="iconfont icon-right"></i></a>
</div>
<div class=post-comment>
</div>
</article>
</div>
</main>
<footer class=footer>
<div class=copyright>
&copy;
<span itemprop=copyrightYear>2016 - 2021</span>
<span class=with-love>
<i class="iconfont icon-love"></i>
</span>
<span class=author itemprop=copyrightHolder><a href=https://wangshub.github.io>神奇的战士</a> | </span>
<span>Powered by <a href=https://gohugo.io/ target=_blank rel="external nofollow">Hugo</a> & <a href=https://github.com/Mogeko/Mogege target=_blank rel="external nofollow">Mogege</a></span>
</div>
</footer>
<script defer src=/js/vendor_main.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin=anonymous></script>
<script>pangu.spacingPage()</script>
</div>
</body>
</html>