<!DOCTYPE html>
<html lang="zh-cn">
    <head>
    <meta http-equiv="content-type" content="text/html;charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noodp"/>
    <meta name="author" content="ç¥å¥‡çš„æˆ˜å£«">
    
    <meta name="keywords" content="blog, GNU/Linux, Linux, Ubuntu, Docker, Robot, Python, DRL">
    
    <link rel="prev" href="https://wangshub.github.io/posts/atom-editor/" />
    <link rel="next" href="https://wangshub.github.io/posts/python-data-structure-bst/" />
    <link rel="canonical" href="https://wangshub.github.io/posts/python-vad/" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
    <title>
        
        
            pythonçš„webrtcåº“å®ç°è¯­éŸ³ç«¯ç‚¹æ£€æµ‹ | ğŸ‰ ç¥å¥‡çš„æˆ˜å£«
        
    </title>
    <meta name="title" content="pythonçš„webrtcåº“å®ç°è¯­éŸ³ç«¯ç‚¹æ£€æµ‹ | ğŸ‰ ç¥å¥‡çš„æˆ˜å£«">
    
<link rel="stylesheet" href="/css/main.min.css">


    
    
 

<script type="application/ld+json">
{
    "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "https:\/\/wangshub.github.io"
    },
    "articleSection" : "posts",
    "name" : "pythonçš„webrtcåº“å®ç°è¯­éŸ³ç«¯ç‚¹æ£€æµ‹",
    "headline" : "pythonçš„webrtcåº“å®ç°è¯­éŸ³ç«¯ç‚¹æ£€æµ‹",
    "description" : "\u003cp\u003eåˆšåˆšæ­äº†åšå®¢\u003ca href=\u0022thinkhard.tech\u0022\u003ethinkhard.tech\u003c\/a\u003e,æ¬¢è¿è¸©è¸©~\u003c\/p\u003e\n\u003ch2 id=\u0022å¼•è¨€\u0022\u003eå¼•è¨€\u003c\/h2\u003e\n\u003cp\u003eè¯­éŸ³ç«¯ç‚¹æ£€æµ‹æœ€æ—©åº”ç”¨äºç”µè¯ä¼ è¾“å’Œæ£€æµ‹ç³»ç»Ÿå½“ä¸­,ç”¨äºé€šä¿¡ä¿¡é“çš„æ—¶é—´åˆ†é…,æé«˜ä¼ è¾“çº¿è·¯çš„åˆ©ç”¨æ•ˆç‡.ç«¯ç‚¹æ£€æµ‹å±äºè¯­éŸ³å¤„ç†ç³»ç»Ÿçš„å‰ç«¯æ“ä½œ,åœ¨è¯­éŸ³æ£€æµ‹é¢†åŸŸæ„ä¹‰é‡å¤§.\u003cbr\u003e\nä½†æ˜¯ç›®å‰çš„è¯­éŸ³ç«¯ç‚¹æ£€æµ‹,å°¤å…¶æ˜¯æ£€æµ‹ \u003cem\u003eäººå£°\u003c\/em\u003e å¼€å§‹å’Œç»“æŸçš„ç«¯ç‚¹å§‹ç»ˆæ˜¯å±äºæŠ€æœ¯éš¾ç‚¹,å„å®¶å…¬å¸å§‹ç»ˆå¤„äº \u003cstrong\u003eèƒ½åˆ¤æ–­\u003c\/strong\u003e,ä½†æ˜¯ä¸æ•¢ä¿è¯ \u003cstrong\u003eåˆ¤åˆ«å‡†ç¡®æ€§\u003c\/strong\u003e çš„é˜¶æ®µ.\u003cbr\u003e\n\u003cimg src=\u0022https:\/\/ooo.0o0.ooo\/2017\/05\/25\/5926ed7fcc2b3.png\u0022 alt=\u0022Screenshot from 2017-05-25 22-42-50.png\u0022\u003e \u003cbr\u003e\nç°åœ¨åŸºäºäº‘ç«¯è¯­ä¹‰åº“çš„èŠå¤©æœºå™¨äººå±‚å‡ºä¸ç©·,å…¶ä¸­æœ€è‘—åçš„å½“å±amazonçš„ \u003cstrong\u003eAlexa\/Echo\u003c\/strong\u003e æ™ºèƒ½éŸ³ç®±.\u003cbr\u003e\n\u003cimg src=\u0022https:\/\/ooo.0o0.ooo\/2017\/05\/25\/5926ee0cbc85b.jpg\u0022 alt=\u0022timg.jpg\u0022\u003e\u003c\/p\u003e\n\u003cp\u003eå›½å†…å¦‚é›¨åæ˜¥ç¬‹èˆ¬å‡ºç°äº†å„ç§æ­è½½è¯­éŸ³èŠå¤©çš„æ™ºèƒ½éŸ³ç®±(å¦‚å‰å‡ å¤©åœ¨çŸ¥ä¹ä¸Šå¹¿å‘Šçš„è‹¥çªæœºå™¨äºº)å’Œå„ç±»æ™ºèƒ½æœºå™¨äººäº§å“.å›½å†…è¯­éŸ³æœåŠ¡æä¾›å•†ä¸»è¦é¢å¯¹ä¸­æ–‡è¯­éŸ³æœåŠ¡,ç”±äºè¯­éŸ³ä¸åƒå›¾åƒæœ‰åˆ†è¾¨ç‡ç­‰ç­‰è¾ƒä¸ºå®¢è§‚çš„æŒ‡æ ‡,å¾ˆå¤šæ—¶å€™å‡­ä¸»è§‚åˆ¤æ–­,æ‰€ä»¥è¾ƒéš¾åˆ¤æ–­å„å®¶è¯­éŸ³è¯†åˆ«å’ŒåˆæˆæŠ€æœ¯çš„å¥½å.ä½†æ˜¯æˆ‘ä¸ªäººè®¤ä¸º,å›½å†…çš„ä¸­æ–‡è¯­éŸ³æœåŠ¡å’Œå›½å¤–çš„è‹±æ–‡è¯­éŸ³æœåŠ¡,åœ¨æŸäº›æ–¹é¢å·²ç»æœ‰è¶…è¶Šçš„è¶‹åŠ¿. \u003cbr\u003e\n\u003cimg src=\u0022https:\/\/ooo.0o0.ooo\/2017\/05\/25\/5926f2220cae2.jpg\u0022 alt=\u0022timg (1).jpg\u0022\u003e\u003c\/p\u003e\n\u003cp\u003eé€šå¸¸æ­å»ºæœºå™¨äººèŠå¤©ç³»ç»Ÿä¸»è¦åŒ…æ‹¬ä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢:\u003c\/p\u003e\n\u003cul\u003e\n\u003cli\u003eè¯­éŸ³è½¬æ–‡å­—(ASR\/STT)\u003c\/li\u003e\n\u003cli\u003eè¯­ä¹‰å†…å®¹(NLU\/NLP)\u003c\/li\u003e\n\u003cli\u003eæ–‡å­—è½¬è¯­éŸ³(TTS)\u003c\/li\u003e\n\u003c\/ul\u003e\n\u003ch2 id=\u0022è¯­éŸ³è½¬æ–‡å­—asrstt\u0022\u003eè¯­éŸ³è½¬æ–‡å­—(ASR\/STT)\u003c\/h2\u003e\n\u003cp\u003eåœ¨å°†è¯­éŸ³ä¼ ç»™äº‘ç«¯APIä¹‹å‰,æ˜¯æœ¬åœ°å‰ç«¯çš„è¯­éŸ³é‡‡é›†,è¿™éƒ¨åˆ†ä¸»è¦åŒ…æ‹¬å¦‚ä¸‹å‡ ä¸ªæ–¹é¢:\u003c\/p\u003e\n\u003cul\u003e\n\u003cli\u003eéº¦å…‹é£é™å™ª\u003c\/li\u003e\n\u003cli\u003eå£°æºå®šä½\u003c\/li\u003e\n\u003cli\u003eå›å£°æ¶ˆé™¤\u003c\/li\u003e\n\u003cli\u003eå”¤é†’è¯\u003c\/li\u003e\n\u003cli\u003eè¯­éŸ³ç«¯ç‚¹æ£€æµ‹\u003c\/li\u003e\n\u003cli\u003eéŸ³é¢‘æ ¼å¼å‹ç¼©\u003c\/li\u003e\n\u003c\/ul\u003e",
    "inLanguage" : "zh-cn",
    "author" : "ç¥å¥‡çš„æˆ˜å£«",
    "creator" : "ç¥å¥‡çš„æˆ˜å£«",
    "publisher": "ç¥å¥‡çš„æˆ˜å£«",
    "accountablePerson" : "ç¥å¥‡çš„æˆ˜å£«",
    "copyrightHolder" : "ç¥å¥‡çš„æˆ˜å£«",
    "copyrightYear" : "2017",
    "datePublished": "2017-05-25 21:47:56 \u002b0000 UTC",
    "dateModified" : "2017-05-25 21:47:56 \u002b0000 UTC",
    "url" : "https:\/\/wangshub.github.io\/posts\/python-vad\/",
    "wordCount" : "1385",
    "keywords" : [ "Code", "ğŸ‰ ç¥å¥‡çš„æˆ˜å£«"]
}
</script>

  </head>
    <body class="">
        <div class="wrapper">
            <nav class="navbar">
    
        <progress class="content_progress" max="0" value="0"></progress>
    
    <div class="container">
        
            <div class="navbar-header header-back2home-logo">
                <span class="logo_mark" >>$</span>
                <a href="https://wangshub.github.io">
                    <span class="logo_text" >cd /home/</span>
                    <span class="logo_cursor" ></span>
                </a>
            </div>
        
        <div class="navbar-right">
                
                <span class="menu">
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
                <span class="divide"></span>
                <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-dark-mode"></i></a>
                </span>
        </div>
    </div>
</nav>
<nav class="navbar-mobile" id="nav-mobile" style="display: none">
    
        <progress class="content_progress" max="0" value="0"></progress>
    
     <div class="container">
        <div class="navbar">
            <div class="navbar-header header-logo">
                    <a href="https://wangshub.github.io">ğŸ‰ ç¥å¥‡çš„æˆ˜å£«</a>
            </div>
            <div class="navbar-right">
                <div><a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-dark-mode"></i></a></div>
                <div class="menu-toggle">
                    <span></span><span></span><span></span>
                </div>
            </div>
        </div>
     
          <div class="menu" id="mobile-menu">
                <nav class="mb-md">
                    
                    
                        <a class="menu-item" href="/posts/" title="">
                            <h3>Blog</h3>
                            <div class="menu-active"></div>
                        </a>
                    
                        <a class="menu-item" href="/tags/" title="">
                            <h3>Tags</h3>
                            <div class="menu-active"></div>
                        </a>
                    
                        <a class="menu-item" href="/about/" title="">
                            <h3>About</h3>
                            <div class="menu-active"></div>
                        </a>
                    
                </nav>
        </div>
    </div>
</nav>
            <main class="main">
                <div class="container">
                    
<article class="post-warp" itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
        <h1 class="post-title" itemprop="name headline">pythonçš„webrtcåº“å®ç°è¯­éŸ³ç«¯ç‚¹æ£€æµ‹</h1>
        <div class="post-meta">
                Written by <a itemprop="name" href="https://wangshub.github.io" rel="author">ç¥å¥‡çš„æˆ˜å£«</a> with â™¥
                <span class="post-time">
                on <time datetime=2017-05-25 itemprop="datePublished">May 25, 2017</time>
                </span>
                in
                
                <i class="iconfont icon-folder"></i>
                <span class="post-category">
                        
                        
                        
                          <a href="https://wangshub.github.io/categories/python/"> Python, </a>
                        
                        
                        
                        
                          <a href="https://wangshub.github.io/categories/code/"> Code, </a>
                        
                        
                </span>
                <span class="post-word-count">1385 words</span>
        </div>
    </header>

    <div class="post-content">
        

        
        
            
        

        
        
        
        
        

        
        
        

        <p>åˆšåˆšæ­äº†åšå®¢<a href="thinkhard.tech">thinkhard.tech</a>,æ¬¢è¿è¸©è¸©~</p>
<h2 id="å¼•è¨€">å¼•è¨€</h2>
<p>è¯­éŸ³ç«¯ç‚¹æ£€æµ‹æœ€æ—©åº”ç”¨äºç”µè¯ä¼ è¾“å’Œæ£€æµ‹ç³»ç»Ÿå½“ä¸­,ç”¨äºé€šä¿¡ä¿¡é“çš„æ—¶é—´åˆ†é…,æé«˜ä¼ è¾“çº¿è·¯çš„åˆ©ç”¨æ•ˆç‡.ç«¯ç‚¹æ£€æµ‹å±äºè¯­éŸ³å¤„ç†ç³»ç»Ÿçš„å‰ç«¯æ“ä½œ,åœ¨è¯­éŸ³æ£€æµ‹é¢†åŸŸæ„ä¹‰é‡å¤§.<br>
ä½†æ˜¯ç›®å‰çš„è¯­éŸ³ç«¯ç‚¹æ£€æµ‹,å°¤å…¶æ˜¯æ£€æµ‹ <em>äººå£°</em> å¼€å§‹å’Œç»“æŸçš„ç«¯ç‚¹å§‹ç»ˆæ˜¯å±äºæŠ€æœ¯éš¾ç‚¹,å„å®¶å…¬å¸å§‹ç»ˆå¤„äº <strong>èƒ½åˆ¤æ–­</strong>,ä½†æ˜¯ä¸æ•¢ä¿è¯ <strong>åˆ¤åˆ«å‡†ç¡®æ€§</strong> çš„é˜¶æ®µ.<br>
<img src="https://ooo.0o0.ooo/2017/05/25/5926ed7fcc2b3.png" alt="Screenshot from 2017-05-25 22-42-50.png" loading="lazy" > <br>
ç°åœ¨åŸºäºäº‘ç«¯è¯­ä¹‰åº“çš„èŠå¤©æœºå™¨äººå±‚å‡ºä¸ç©·,å…¶ä¸­æœ€è‘—åçš„å½“å±amazonçš„ <strong>Alexa/Echo</strong> æ™ºèƒ½éŸ³ç®±.<br>
<img src="https://ooo.0o0.ooo/2017/05/25/5926ee0cbc85b.jpg" alt="timg.jpg" loading="lazy" ></p>
<p>å›½å†…å¦‚é›¨åæ˜¥ç¬‹èˆ¬å‡ºç°äº†å„ç§æ­è½½è¯­éŸ³èŠå¤©çš„æ™ºèƒ½éŸ³ç®±(å¦‚å‰å‡ å¤©åœ¨çŸ¥ä¹ä¸Šå¹¿å‘Šçš„è‹¥çªæœºå™¨äºº)å’Œå„ç±»æ™ºèƒ½æœºå™¨äººäº§å“.å›½å†…è¯­éŸ³æœåŠ¡æä¾›å•†ä¸»è¦é¢å¯¹ä¸­æ–‡è¯­éŸ³æœåŠ¡,ç”±äºè¯­éŸ³ä¸åƒå›¾åƒæœ‰åˆ†è¾¨ç‡ç­‰ç­‰è¾ƒä¸ºå®¢è§‚çš„æŒ‡æ ‡,å¾ˆå¤šæ—¶å€™å‡­ä¸»è§‚åˆ¤æ–­,æ‰€ä»¥è¾ƒéš¾åˆ¤æ–­å„å®¶è¯­éŸ³è¯†åˆ«å’ŒåˆæˆæŠ€æœ¯çš„å¥½å.ä½†æ˜¯æˆ‘ä¸ªäººè®¤ä¸º,å›½å†…çš„ä¸­æ–‡è¯­éŸ³æœåŠ¡å’Œå›½å¤–çš„è‹±æ–‡è¯­éŸ³æœåŠ¡,åœ¨æŸäº›æ–¹é¢å·²ç»æœ‰è¶…è¶Šçš„è¶‹åŠ¿. <br>
<img src="https://ooo.0o0.ooo/2017/05/25/5926f2220cae2.jpg" alt="timg (1).jpg" loading="lazy" ></p>
<p>é€šå¸¸æ­å»ºæœºå™¨äººèŠå¤©ç³»ç»Ÿä¸»è¦åŒ…æ‹¬ä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢:</p>
<ul>
<li>è¯­éŸ³è½¬æ–‡å­—(ASR/STT)</li>
<li>è¯­ä¹‰å†…å®¹(NLU/NLP)</li>
<li>æ–‡å­—è½¬è¯­éŸ³(TTS)</li>
</ul>
<h2 id="è¯­éŸ³è½¬æ–‡å­—asrstt">è¯­éŸ³è½¬æ–‡å­—(ASR/STT)</h2>
<p>åœ¨å°†è¯­éŸ³ä¼ ç»™äº‘ç«¯APIä¹‹å‰,æ˜¯æœ¬åœ°å‰ç«¯çš„è¯­éŸ³é‡‡é›†,è¿™éƒ¨åˆ†ä¸»è¦åŒ…æ‹¬å¦‚ä¸‹å‡ ä¸ªæ–¹é¢:</p>
<ul>
<li>éº¦å…‹é£é™å™ª</li>
<li>å£°æºå®šä½</li>
<li>å›å£°æ¶ˆé™¤</li>
<li>å”¤é†’è¯</li>
<li>è¯­éŸ³ç«¯ç‚¹æ£€æµ‹</li>
<li>éŸ³é¢‘æ ¼å¼å‹ç¼©</li>
</ul>
<h2 id="python-ç«¯ç‚¹æ£€æµ‹">python ç«¯ç‚¹æ£€æµ‹</h2>
<p>ç”±äºå®é™…åº”ç”¨ä¸­,å•çº¯ä¾é èƒ½é‡æ£€æµ‹ç‰¹å¾æ£€æµ‹ç­‰æ–¹æ³•å¾ˆéš¾åˆ¤æ–­äººå£°è¯´è¯çš„èµ·å§‹ç‚¹,æ‰€ä»¥å¸‚é¢ä¸Šå¤§å¤šæ•°çš„è¯­éŸ³äº§å“éƒ½æ˜¯ä½¿ç”¨å”¤é†’è¯åˆ¤æ–­è¯­éŸ³èµ·å§‹.å¦å¤–åŠ ä¸Šå£°éŸ³å›è·¯,è¿˜å¯ä»¥åšè¯­éŸ³æ‰“æ–­.è¿™æ ·çš„äº¤äº’æ–¹å¼å¯èƒ½æœ‰äº›å‚»,æ¯æ¬¡å¿…é¡»å–Šä¸€ä¸‹ <em>å”¤é†’è¯</em> æ‰èƒ½ç»§ç»­èŠå¤©.è¿™ç§æ–¹å¼èŠå¤šäº†,ä¸ªäººæ„Ÿè§‰ä¼šå˜´å·´ç–¼:-O .ç°åœ¨githubä¸Šæœ‰snowboyå”¤é†’è¯çš„å¼€æºåº“,å¤§å®¶å¯ä»¥ç™»å½•snowboyå®˜ç½‘è®­ç»ƒè‡ªå·±çš„å”¤é†’è¯æ¨¡å‹.</p>
<ul>
<li>Kitt-AI : <a href="https://github.com/Kitt-AI/snowboy">Snowboy</a></li>
<li>Sensory : <a href="http://www.sensory.com/">Sensory</a></li>
</ul>
<p>è€ƒè™‘åˆ°ç”¨å”¤é†’è¯å˜´å·´ä¼šç´¯,æ‰€ä»¥å¤§è‡´è°ƒç ”äº†ä¸€ä¸‹,pythonæ‹¥æœ‰ä¸°å¯Œçš„åº“,ç›´æ¥importå°±èƒ½é£Ÿç”¨.è¿™ç§æ–¹å¼å®¹æ˜“å—å¼ºå™ªå£°å¹²æ‰°,é€‚åˆä¸€ä¸ªäººåœ¨å®¶ç©ç©.</p>
<ul>
<li>pyaudio: <code>pip install pyaudio</code> å¯ä»¥ä»è®¾å¤‡èŠ‚ç‚¹è¯»å–åŸå§‹éŸ³é¢‘æµæ•°æ®,éŸ³é¢‘ç¼–ç æ˜¯PCMæ ¼å¼;</li>
<li>webrtcvad: <code>pip install webrtcvad</code> æ£€æµ‹åˆ¤æ–­ä¸€ç»„è¯­éŸ³æ•°æ®æ˜¯å¦ä¸ºç©ºè¯­éŸ³;
å½“æ£€æµ‹åˆ°æŒç»­æ—¶é—´é•¿åº¦ <em>T1</em> vadæ£€æµ‹éƒ½æœ‰è¯­éŸ³æ´»åŠ¨,å¯ä»¥åˆ¤å®šä¸ºè¯­éŸ³èµ·å§‹;
å½“æ£€æµ‹åˆ°æŒç»­æ—¶é—´é•¿åº¦ <em>T2</em> vadæ£€æµ‹éƒ½æ²¡æœ‰æœ‰è¯­éŸ³æ´»åŠ¨,å¯ä»¥åˆ¤å®šä¸ºè¯­éŸ³ç»“æŸ;</li>
</ul>
<p>å®Œæ•´ç¨‹åºä»£ç å¯ä»¥ä»æˆ‘çš„<a href="https://github.com/wangshub/python-vad">github</a>ä¸‹è½½    <br>
ç¨‹åºå¾ˆç®€å•,ç›¸ä¿¡çœ‹ä¸€ä¼šå„¿å°±æ˜ç™½äº†</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#e6db74">&#39;&#39;&#39;
</span><span style="color:#e6db74">Requirements:
</span><span style="color:#e6db74">+ pyaudio - `pip install pyaudio`
</span><span style="color:#e6db74">+ py-webrtcvad - `pip install webrtcvad`
</span><span style="color:#e6db74">&#39;&#39;&#39;</span>
<span style="color:#f92672">import</span> webrtcvad
<span style="color:#f92672">import</span> collections
<span style="color:#f92672">import</span> sys
<span style="color:#f92672">import</span> signal
<span style="color:#f92672">import</span> pyaudio

<span style="color:#f92672">from</span> array <span style="color:#f92672">import</span> array
<span style="color:#f92672">from</span> struct <span style="color:#f92672">import</span> pack
<span style="color:#f92672">import</span> wave
<span style="color:#f92672">import</span> time

FORMAT <span style="color:#f92672">=</span> pyaudio<span style="color:#f92672">.</span>paInt16
CHANNELS <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
RATE <span style="color:#f92672">=</span> <span style="color:#ae81ff">16000</span>
CHUNK_DURATION_MS <span style="color:#f92672">=</span> <span style="color:#ae81ff">30</span>       <span style="color:#75715e"># supports 10, 20 and 30 (ms)</span>
PADDING_DURATION_MS <span style="color:#f92672">=</span> <span style="color:#ae81ff">1500</span>   <span style="color:#75715e"># 1 sec jugement</span>
CHUNK_SIZE <span style="color:#f92672">=</span> int(RATE <span style="color:#f92672">*</span> CHUNK_DURATION_MS <span style="color:#f92672">/</span> <span style="color:#ae81ff">1000</span>)  <span style="color:#75715e"># chunk to read</span>
CHUNK_BYTES <span style="color:#f92672">=</span> CHUNK_SIZE <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>  <span style="color:#75715e"># 16bit = 2 bytes, PCM</span>
NUM_PADDING_CHUNKS <span style="color:#f92672">=</span> int(PADDING_DURATION_MS <span style="color:#f92672">/</span> CHUNK_DURATION_MS)
<span style="color:#75715e"># NUM_WINDOW_CHUNKS = int(240 / CHUNK_DURATION_MS)</span>
NUM_WINDOW_CHUNKS <span style="color:#f92672">=</span> int(<span style="color:#ae81ff">400</span> <span style="color:#f92672">/</span> CHUNK_DURATION_MS)  <span style="color:#75715e"># 400 ms/ 30ms  ge</span>
NUM_WINDOW_CHUNKS_END <span style="color:#f92672">=</span> NUM_WINDOW_CHUNKS <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>

START_OFFSET <span style="color:#f92672">=</span> int(NUM_WINDOW_CHUNKS <span style="color:#f92672">*</span> CHUNK_DURATION_MS <span style="color:#f92672">*</span> <span style="color:#ae81ff">0.5</span> <span style="color:#f92672">*</span> RATE)

vad <span style="color:#f92672">=</span> webrtcvad<span style="color:#f92672">.</span>Vad(<span style="color:#ae81ff">1</span>)

pa <span style="color:#f92672">=</span> pyaudio<span style="color:#f92672">.</span>PyAudio()
stream <span style="color:#f92672">=</span> pa<span style="color:#f92672">.</span>open(format<span style="color:#f92672">=</span>FORMAT,
                 channels<span style="color:#f92672">=</span>CHANNELS,
                 rate<span style="color:#f92672">=</span>RATE,
                 input<span style="color:#f92672">=</span>True,
                 start<span style="color:#f92672">=</span>False,
                 <span style="color:#75715e"># input_device_index=2,</span>
                 frames_per_buffer<span style="color:#f92672">=</span>CHUNK_SIZE)


got_a_sentence <span style="color:#f92672">=</span> False
leave <span style="color:#f92672">=</span> False


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">handle_int</span>(sig, chunk):
    <span style="color:#66d9ef">global</span> leave, got_a_sentence
    leave <span style="color:#f92672">=</span> True
    got_a_sentence <span style="color:#f92672">=</span> True


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">record_to_file</span>(path, data, sample_width):
    <span style="color:#e6db74">&#34;Records from the microphone and outputs the resulting data to &#39;path&#39;&#34;</span>
    <span style="color:#75715e"># sample_width, data = record()</span>
    data <span style="color:#f92672">=</span> pack(<span style="color:#e6db74">&#39;&lt;&#39;</span> <span style="color:#f92672">+</span> (<span style="color:#e6db74">&#39;h&#39;</span> <span style="color:#f92672">*</span> len(data)), <span style="color:#f92672">*</span>data)
    wf <span style="color:#f92672">=</span> wave<span style="color:#f92672">.</span>open(path, <span style="color:#e6db74">&#39;wb&#39;</span>)
    wf<span style="color:#f92672">.</span>setnchannels(<span style="color:#ae81ff">1</span>)
    wf<span style="color:#f92672">.</span>setsampwidth(sample_width)
    wf<span style="color:#f92672">.</span>setframerate(RATE)
    wf<span style="color:#f92672">.</span>writeframes(data)
    wf<span style="color:#f92672">.</span>close()


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">normalize</span>(snd_data):
    <span style="color:#e6db74">&#34;Average the volume out&#34;</span>
    MAXIMUM <span style="color:#f92672">=</span> <span style="color:#ae81ff">32767</span>  <span style="color:#75715e"># 16384</span>
    times <span style="color:#f92672">=</span> float(MAXIMUM) <span style="color:#f92672">/</span> max(abs(i) <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> snd_data)
    r <span style="color:#f92672">=</span> array(<span style="color:#e6db74">&#39;h&#39;</span>)
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> snd_data:
        r<span style="color:#f92672">.</span>append(int(i <span style="color:#f92672">*</span> times))
    <span style="color:#66d9ef">return</span> r

signal<span style="color:#f92672">.</span>signal(signal<span style="color:#f92672">.</span>SIGINT, handle_int)

<span style="color:#66d9ef">while</span> <span style="color:#f92672">not</span> leave:
    ring_buffer <span style="color:#f92672">=</span> collections<span style="color:#f92672">.</span>deque(maxlen<span style="color:#f92672">=</span>NUM_PADDING_CHUNKS)
    triggered <span style="color:#f92672">=</span> False
    voiced_frames <span style="color:#f92672">=</span> []
    ring_buffer_flags <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> NUM_WINDOW_CHUNKS
    ring_buffer_index <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>

    ring_buffer_flags_end <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> NUM_WINDOW_CHUNKS_END
    ring_buffer_index_end <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    buffer_in <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
    <span style="color:#75715e"># WangS</span>
    raw_data <span style="color:#f92672">=</span> array(<span style="color:#e6db74">&#39;h&#39;</span>)
    index <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    start_point <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    StartTime <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time()
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;* recording: &#34;</span>)
    stream<span style="color:#f92672">.</span>start_stream()

    <span style="color:#66d9ef">while</span> <span style="color:#f92672">not</span> got_a_sentence <span style="color:#f92672">and</span> <span style="color:#f92672">not</span> leave:
        chunk <span style="color:#f92672">=</span> stream<span style="color:#f92672">.</span>read(CHUNK_SIZE)
        <span style="color:#75715e"># add WangS</span>
        raw_data<span style="color:#f92672">.</span>extend(array(<span style="color:#e6db74">&#39;h&#39;</span>, chunk))
        index <span style="color:#f92672">+=</span> CHUNK_SIZE
        TimeUse <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time() <span style="color:#f92672">-</span> StartTime

        active <span style="color:#f92672">=</span> vad<span style="color:#f92672">.</span>is_speech(chunk, RATE)

        sys<span style="color:#f92672">.</span>stdout<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#39;1&#39;</span> <span style="color:#66d9ef">if</span> active <span style="color:#66d9ef">else</span> <span style="color:#e6db74">&#39;_&#39;</span>)
        ring_buffer_flags[ring_buffer_index] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">if</span> active <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">0</span>
        ring_buffer_index <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
        ring_buffer_index <span style="color:#f92672">%=</span> NUM_WINDOW_CHUNKS

        ring_buffer_flags_end[ring_buffer_index_end] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">if</span> active <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">0</span>
        ring_buffer_index_end <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
        ring_buffer_index_end <span style="color:#f92672">%=</span> NUM_WINDOW_CHUNKS_END

        <span style="color:#75715e"># start point detection</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> triggered:
            ring_buffer<span style="color:#f92672">.</span>append(chunk)
            num_voiced <span style="color:#f92672">=</span> sum(ring_buffer_flags)
            <span style="color:#66d9ef">if</span> num_voiced <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0.8</span> <span style="color:#f92672">*</span> NUM_WINDOW_CHUNKS:
                sys<span style="color:#f92672">.</span>stdout<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#39; Open &#39;</span>)
                triggered <span style="color:#f92672">=</span> True
                start_point <span style="color:#f92672">=</span> index <span style="color:#f92672">-</span> CHUNK_SIZE <span style="color:#f92672">*</span> <span style="color:#ae81ff">20</span>  <span style="color:#75715e"># start point</span>
                <span style="color:#75715e"># voiced_frames.extend(ring_buffer)</span>
                ring_buffer<span style="color:#f92672">.</span>clear()
        <span style="color:#75715e"># end point detection</span>
        <span style="color:#66d9ef">else</span>:
            <span style="color:#75715e"># voiced_frames.append(chunk)</span>
            ring_buffer<span style="color:#f92672">.</span>append(chunk)
            num_unvoiced <span style="color:#f92672">=</span> NUM_WINDOW_CHUNKS_END <span style="color:#f92672">-</span> sum(ring_buffer_flags_end)
            <span style="color:#66d9ef">if</span> num_unvoiced <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0.90</span> <span style="color:#f92672">*</span> NUM_WINDOW_CHUNKS_END <span style="color:#f92672">or</span> TimeUse <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">10</span>:
                sys<span style="color:#f92672">.</span>stdout<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#39; Close &#39;</span>)
                triggered <span style="color:#f92672">=</span> False
                got_a_sentence <span style="color:#f92672">=</span> True

        sys<span style="color:#f92672">.</span>stdout<span style="color:#f92672">.</span>flush()

    sys<span style="color:#f92672">.</span>stdout<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)
    <span style="color:#75715e"># data = b&#39;&#39;.join(voiced_frames)</span>

    stream<span style="color:#f92672">.</span>stop_stream()
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;* done recording&#34;</span>)
    got_a_sentence <span style="color:#f92672">=</span> False

    <span style="color:#75715e"># write to file</span>
    raw_data<span style="color:#f92672">.</span>reverse()
    <span style="color:#66d9ef">for</span> index <span style="color:#f92672">in</span> range(start_point):
        raw_data<span style="color:#f92672">.</span>pop()
    raw_data<span style="color:#f92672">.</span>reverse()
    raw_data <span style="color:#f92672">=</span> normalize(raw_data)
    record_to_file(<span style="color:#e6db74">&#34;recording.wav&#34;</span>, raw_data, <span style="color:#ae81ff">2</span>)
    leave <span style="color:#f92672">=</span> True

stream<span style="color:#f92672">.</span>close()
</code></pre></div><p>ç¨‹åºè¿è¡Œæ–¹å¼<code>sudo python vad.py</code> <br>
qrcode_for_gh_3586401957c4_258.jpg	 Remove</p>
    </div>

    <div class="post-copyright">
            
            <p class="copyright-item">
                <span>Author:</span>
                <span>ç¥å¥‡çš„æˆ˜å£« </span>
                </p>
            

            
            <p class="copyright-item">
                    <span>Link:</span>
                    <a href=https://wangshub.github.io/posts/python-vad/>https://wangshub.github.io/posts/python-vad/</span>
            </p>
            
            
            <p class="copyright-item lincese">
                æœ¬æ–‡é‡‡ç”¨<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨ 4.0 å›½é™…è®¸å¯åè®®</a>è¿›è¡Œè®¸å¯
            </p>
            
    </div>


    <div class="post-tags">
        
            <section>
            <i class="iconfont icon-tag"></i>Tag(s):
            
            <span class="tag"><a href="https://wangshub.github.io/tags/code/">
                    #Code</a></span>
            
            </section>
        
        <section>
                <a href="javascript:window.history.back();">back</a></span> Â·
                <span><a href="https://wangshub.github.io">home</a></span>
        </section>
    </div>

    <div class="post-nav">
        
        <a href="https://wangshub.github.io/posts/atom-editor/" class="prev" rel="prev" title="Atom editor"><i class="iconfont icon-left"></i>&nbsp;Atom editor</a>
        
        
        <a href="https://wangshub.github.io/posts/python-data-structure-bst/" class="next" rel="next" title="python æ•°æ®ç»“æ„ä¹‹äºŒå‰æœç´¢æ ‘">python æ•°æ®ç»“æ„ä¹‹äºŒå‰æœç´¢æ ‘&nbsp;<i class="iconfont icon-right"></i></a>
        
    </div>

    <div class="post-comment">
        
            
        
    </div>
</article>
                </div>
            </main>
            <footer class="footer">
    <div class="copyright">
        &copy;
        
        <span itemprop="copyrightYear">2016 - 2021</span>
        
        <span class="with-love">
    	 <i class="iconfont icon-love"></i>
         </span>
         
            <span class="author" itemprop="copyrightHolder"><a href="https://wangshub.github.io">ç¥å¥‡çš„æˆ˜å£«</a> | </span>
         

         
		  <span>Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow">Hugo</a> & <a href="https://github.com/Mogeko/Mogege" target="_blank" rel="external nofollow">Mogege</a></span>
    </div>
</footer>






<script defer src="/js/vendor_main.min.js"></script>







<script src="https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script>
<script> pangu.spacingPage();</script>



<script>
  MathJax = {
    tex: {
      inlineMath: [["$", "$"]],
    },
    displayMath: [
      ["$$", "$$"],
      ["\[\[", "\]\]"],
    ],
    svg: {
      fontCache: "global",
    },
  };
</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
></script>

        </div>
    </body>
</html>
